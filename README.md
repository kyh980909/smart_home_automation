# smart_home_automation

PyQt5 기반의 간단한 스마트홈 데모입니다. 패널과 챗봇 프로그램을 함께 실행하여
장치 제어와 패턴 기반 서비스를 시험해 볼 수 있습니다.

## 🔄 최근 업데이트

**데이터 저장 방식 변경**: SQLite → CSV 파일

- 더 간단하고 직관적인 데이터 관리
- 데이터 파일을 직접 열어서 확인 가능
- 별도의 DB 설치나 설정 불필요

## 📁 데이터 파일 구조

```
data/
├── devices.csv    # 디바이스 상태 정보
├── patterns.csv   # 사용 패턴 기록
├── rules.csv      # 자동화 규칙
└── generated.csv  # 생성된 학습 데이터
```

## 실행 방법

```bash
python3 main_panel.py   # 패널 실행
python3 chatbot.py      # 챗봇 실행
```
패널은 기본적으로 포트 `7777`에서, 챗봇은 포트 `7778`에서 동작합니다.
필요하다면 `communication.start_server()`와 `send_message()` 함수의
`host`/`port` 인자를 수정해 다른 포트를 사용할 수 있습니다.

두 프로그램을 동시에 실행하면 패널에서 감지한 패턴이나 사용자 명령이 챗봇으로
전송되고, 챗봇에서 Yes/No 버튼이나 직접 입력으로 답할 수 있습니다.

## 주요 기능

### 패널 (MainPanel)

- **장치 제어** – 거실조명, 주방조명, 가스밸브 등 기본 장치를 ON/OFF 하며 상태를 DB에 기록합니다.
- **학습 데이터 생성** – 특정 시간에 동작을 추가하여 일주일치 패턴을 만들고 CSV로 저장합니다.
- **학습 탭** – 저장된 CSV 파일을 불러와 반복되는 사용 패턴을 분석합니다.
- **서비스 탭** – 패턴 이벤트를 시뮬레이션하며 1x/10x/60x 속도로 시간을 진행합니다. 감지된 패턴은 챗봇으로 알림을 보냅니다.
- **조회 탭** – 달력에서 날짜를 선택하여 해당 날짜의 이벤트를 테이블로 확인합니다.
- **환경설정 탭** – 패턴 감지 민감도와 챗봇 알림 사용 여부를 설정합니다.

### 챗봇 (ChatBot)

- 패널과 소켓 통신을 통해 메시지를 교환합니다.
- 패널에서 보낸 알림을 대화 형식으로 표시하며, `Yes/No` 버튼이나 텍스트 입력으로 응답을 보낼 수 있습니다.
- 사용자가 "Yes"라고 답하면 패널에서 규칙 생성 명령을 처리합니다.

### 기타 모듈

- `csv_database.py` – CSV 파일 기반의 간단한 저장소로 장치 상태와 패턴, 규칙을 기록합니다.
- `data_generator.py` – 기본 패턴 생성과 변형, CSV 입출력 기능을 제공합니다.
- `ai_models.py` – 반복 패턴 탐지와 이상 행동 감지를 위한 보조 클래스를 포함합니다.
- `communication.py` – 패널과 챗봇 간 TCP 소켓 통신을 담당합니다.
- `floor_plan.py` – 스마트홈 평면도 시각화 및 디바이스 상호작용 기능을 제공합니다.
- `database_sqlite_backup.py` – 이전 SQLite 버전 (백업용)

## 실행 예시

1. 두 개의 터미널을 열어 각각 아래 명령을 실행합니다.

```bash
python3 main_panel.py
python3 chatbot.py
```

2. 패널의 **학습 데이터 생성** 탭에서 패턴을 추가한 뒤 `일주일치 생성`을 누르고 `CSV 저장`을 클릭합니다.
3. **학습** 탭에서 `데이터 불러오기`를 눌러 방금 생성한 CSV를 읽어 들인 후 `패턴 분석 시작`을 실행합니다.
4. **서비스** 탭에서 `Play`를 눌러 시뮬레이션을 시작하면 패턴이 감지될 때마다 챗봇 창에 알림이 표시됩니다.
5. 챗봇에서 `Yes` 또는 `No` 버튼을 눌러 응답하면 그 내용이 패널 로그에 기록됩니다.
